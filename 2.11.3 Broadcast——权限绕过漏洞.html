<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>2.11.3 Broadcast——权限绕过漏洞</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="z15r" id="2113-broadcast权限绕过漏洞">2.11.3 Broadcast——权限绕过漏洞</h1><div class="md-section-divider"></div><h2 data-anchor-id="ehp7" id="问题描述">问题描述</h2><blockquote data-anchor-id="dk0z" class="white-blockquote">
  <p>有两种方法可以注册广播接收器。一种是在AndroidMainfest.xml文件中通过标签静态注册。另外一种是通过Context.registerReceiver()动态注册，指定相应的intentfilter参数。然而动态注册的广播默认是导出的。如果导出的BroadcastReceiver没有做好权限控制，导致BroadcastReceiver组件可以接收一个外部可控的url,或者其他命令，导致发送恶意广播攻击者可以越权处理应用的一些特定功能 ，比如发送恶意广播，伪造消息，任意应用下载安装，打开钓鱼网站等。</p>
</blockquote><div class="md-section-divider"></div><h2 data-anchor-id="5xfb" id="风险等级">风险等级</h2><blockquote data-anchor-id="ua16" class="white-blockquote">
  <p>视影响情况而定</p>
</blockquote><div class="md-section-divider"></div><h2 data-anchor-id="ha7d" id="检测方法">检测方法</h2><ul data-anchor-id="v19q">
<li>对于静态注册的广播：查看配置文件中receiver,查看是否有导出，是否有intent-filter。搜索action,然后找到相关的发送操作</li>
<li>对于动态注册的广播：在反汇编代码中查找IntentFilter,registerReceiver等关键字定位所在的广播action值。然后根据找到的action,如com.xxx.yyyy等搜索，然后肇东相关的发送操作。</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="w796" id="修复建议">修复建议</h2><blockquote data-anchor-id="648f" class="white-blockquote">
  <p>使用LocalBroadcastManager类，这个类相较于Context.sendBroadcast(intent)有三方面的优势：</p>
</blockquote><ol data-anchor-id="01kj">
<li>不用担心敏感数据泄露，通过这种方式发送的广播只能应用内接收</li>
<li>不用担心安全漏洞被利用，因为其他应用无法发送恶意广播给你</li>
<li>比系统的全局广播更高效。</li>
</ol><div class="md-section-divider"></div><h2 data-anchor-id="uosx" id="其他">其他</h2><p data-anchor-id="3xr6">通过命令行执行adb shell am broadcast发送广播通知。 <br>
adb shell am broadcast 后面的参数有：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b28u"><ol class="linenums"><li class="L0"><code><span class="pun">[-</span><span class="pln">a  </span><span class="pun">&lt;</span><span class="pln">ACTION</span><span class="pun">&gt;]</span></code></li><li class="L1"><code><span class="pun">[-</span><span class="pln">d </span><span class="pun">&lt;</span><span class="pln">DATA_URI</span><span class="pun">&gt;]</span></code></li><li class="L2"><code><span class="pun">[-</span><span class="pln">t </span><span class="pun">&lt;</span><span class="pln">MIME_TYPE</span><span class="pun">&gt;]</span><span class="pln"> </span></code></li><li class="L3"><code><span class="pun">[-</span><span class="pln">c </span><span class="pun">&lt;</span><span class="pln">CATEGORY</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">[-</span><span class="pln">c </span><span class="pun">&lt;</span><span class="pln">CATEGORY</span><span class="pun">&gt;]</span><span class="pln"> </span><span class="pun">...]</span><span class="pln"> </span></code></li><li class="L4"><code><span class="pun">[-</span><span class="pln">e</span><span class="pun">|--</span><span class="pln">es </span><span class="pun">&lt;</span><span class="pln">EXTRA_KEY</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">EXTRA_STRING_VALUE</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">...]</span><span class="pln"> </span></code></li><li class="L5"><code><span class="pun">[--</span><span class="pln">ez </span><span class="pun">&lt;</span><span class="pln">EXTRA_KEY</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">EXTRA_BOOLEAN_VALUE</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">...]</span><span class="pln"> </span></code></li><li class="L6"><code><span class="pun">[-</span><span class="pln">e</span><span class="pun">|--</span><span class="pln">ei </span><span class="pun">&lt;</span><span class="pln">EXTRA_KEY</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">EXTRA_INT_VALUE</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">...]</span><span class="pln"> </span></code></li><li class="L7"><code><span class="pun">[-</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln">COMPONENT</span><span class="pun">&gt;]</span></code></li><li class="L8"><code><span class="pun">[-</span><span class="pln">f </span><span class="pun">&lt;</span><span class="pln">FLAGS</span><span class="pun">&gt;]</span><span class="pln"> </span><span class="pun">[&lt;</span><span class="pln">URI</span><span class="pun">&gt;]</span></code></li><li class="L9"><code></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pun">例如：</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">adb shell am broadcast </span><span class="pun">-</span><span class="pln">a com</span><span class="pun">.</span><span class="pln">android</span><span class="pun">.</span><span class="pln">test </span><span class="pun">--</span><span class="pln">es test_string </span><span class="str">"this is test string"</span><span class="pln"> </span><span class="pun">--</span><span class="pln">ei test_int </span><span class="lit">100</span><span class="pln"> </span><span class="pun">--</span><span class="pln">ez test_boolean </span><span class="kwd">true</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="9e3h" id="参考链接">参考链接</h2><p data-anchor-id="dtkl"><a href="http://www.secevery.com:4321/bugs/wooyun-2014-084516" target="_blank">http://www.secevery.com:4321/bugs/wooyun-2014-084516</a></p></div>
</body>
</html>