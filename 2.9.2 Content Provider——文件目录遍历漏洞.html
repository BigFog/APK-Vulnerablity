<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>2.9.2 Content Provider——文件目录遍历漏洞</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="d0hb" id="292-content-provider文件目录遍历漏洞">2.9.2 Content Provider——文件目录遍历漏洞</h1><div class="md-section-divider"></div><h2 data-anchor-id="l2rx" id="问题描述">问题描述</h2><blockquote data-anchor-id="8xn9" class="white-blockquote">
  <p>Android Content Provider存在文件目录遍历安全漏洞，该漏洞源于对外暴露Content Provider组件，没有对Content Provider组件的访问进行权限控制和访问的目标文件Uri进行有效判断。攻击者利用该该应用暴露的Content provider的openFile（）接口进行文件目录遍历以达到访问任意可读文件的目的。</p>
</blockquote><div class="md-section-divider"></div><h2 data-anchor-id="9mme" id="风险等级">风险等级</h2><blockquote data-anchor-id="cl2y" class="white-blockquote">
  <p>视情况而定</p>
</blockquote><div class="md-section-divider"></div><h2 data-anchor-id="7ut9" id="检测方法">检测方法</h2><blockquote data-anchor-id="210j" class="white-blockquote">
  <p>查找AndroidMainfest.xml文件是否导出，进而查找openfile函数</p>
</blockquote><div class="md-section-divider"></div><h2 data-anchor-id="l4wa" id="修复建议">修复建议</h2><p></p><ul data-anchor-id="pb7p"> <br>
<li>将不必要的Content Provider设置为不导出。</li>
<li>去除没有必要的openFile（）接口</li>
<li>过滤限制跨域访问，对访问的目标文件的路径进行有效判断。 <br><p></p>

<blockquote class="white-blockquote">
  使用Uri.decode()先对Content Query Uri进行解码后，在过滤如可通过“../”实现任意可读文件的访问Uri字符串</blockquote></li>
  <li>设置权限来进行内部应用通过provider 的数据共享</li>
  </ul><div class="md-section-divider"></div><h2 data-anchor-id="5bsh" id="其他">其他</h2><p data-anchor-id="0s6p"><a href="https://note.youdao.com/ynoteshare1/index.html?id=00f2d5f0c3de1fb548da5ee011dad0ca&amp;type=notebook#/2B0E769D4553443980327A14BDC2A01B" target="_blank">https://note.youdao.com/ynoteshare1/index.html?id=00f2d5f0c3de1fb548da5ee011dad0ca&amp;type=notebook#/2B0E769D4553443980327A14BDC2A01B</a> <br>
<a href="http://www.bigfog.info/2019/02/15/Content%20provider%20%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" target="_blank">http://www.bigfog.info/2019/02/15/Content%20provider%20%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</a></p></div>
</body>
</html>